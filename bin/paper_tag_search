#!/bin/sh

SUBSELECT=""
if [ "$#" -gt "0" ]
then
    TAG=$1
    shift
    SUBSELECT="SELECT doc_id FROM tags WHERE tag = \"$TAG\""
fi

for TAG in "$@"
do
    SUBSELECT=$SUBSELECT" INTERSECT SELECT doc_id FROM tags WHERE tag = \"$TAG\""
done

SELECT="SELECT path FROM papers WHERE doc_id IN ($SUBSELECT)"

sqlite3 papers.db "$SELECT"
